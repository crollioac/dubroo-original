var languagesKnown=[];$(document).ready(function(){getLanguages();$(".editIcon").click(function(a){a.stopPropagation();$(this).parent().next().show()});$(".editNameInput").keydown(function(a){a.stopPropagation();$(".checkAvailableBtn").show();$(".submitNameBtn").hide();$(".msg").remove()});$(".checkAvailableBtn").click(function(c){c.preventDefault();c.stopPropagation();var b=$(".editNameInput").val();var a=ValidateHandle(b);if(a=="valid"){CheckHandleAvailability(b)}else{$(".editNameInput").after("<span class='msg errorMsg'>Invalid name</span>");setTimeout(function(){$(".msg").remove()},3000)}});$(".submitNameBtn").click(function(b){b.stopPropagation();var a=$(".editNameInput").val();UpdateUserDisplayName(a)});$(".closeEditOption").click(function(a){a.stopPropagation();$(".editNameField").hide();$(".checkAvailableBtn").show();$(".submitNameBtn").hide()});$(".closeLanguages").click(function(a){a.stopPropagation();$(this).parent().hide()});$(".languageListInput").change(function(a){a.stopPropagation();var b=$(this).val();$(this).val("");selectLanguage(b)});$(".updateLanguages").click(function(a){a.stopPropagation();updateLanguages()})});CheckHandleAvailability=function(a){$.ajax({type:"GET",url:baseurl+"/user/checkUserHandleAvailability?handle="+a,dataType:"json",success:function(b){if(b.available=="true"){$(".checkAvailableBtn").hide();$(".submitNameBtn").show();$(".submitNameBtn").after("<span class='msg successMsg'>Available</span>")}else{$(".checkAvailableBtn").after("<span class='msg errorMsg'>Not Available</span>")}setTimeout(function(){$(".msg").remove()},5000)}})};ValidateHandle=function(c){var a=$.trim(c).length;var b=/^[a-zA-Z0-9_]+$/;if(a>6&&a<15&&b.test(c)){return"valid"}else{return"invalid"}};UpdateUserDisplayName=function(a){$.ajax({type:"GET",url:baseurl+"/user/updateUserName?handle="+a,dataType:"json",success:function(b){if(b.newName!=undefined){$(".userNameField").html(b.newName);$(".userName").html(b.newName);$(".editNameField").hide();$(".editNameInput").val("");$(".checkAvailableBtn").show();$(".submitNameBtn").hide()}else{$(".editNameInput").after("<span class='msg errorMsg'>Not Available</span>")}}})};GetUsersDubs=function(){};examineUserProfile=function(b){var a=b.split("?uh=")[1];console.log(a);if(a==""||a==undefined){setTimeout(function(){if(userLoginStatus==false){window.location="/"}},1000);a=userDisplayName;UserDataAPI(a)}else{if(a==userDisplayName){window.location=b.split("?uh=")[0]}disableEditOptions();UserDataAPI(a)}};disableEditOptions=function(){$(".editIcon").hide()};UserDataAPI=function(a){$.ajax({type:"GET",url:baseurl+"/user/userDetailsByhandle?handle="+a,dataType:"json",success:function(b){renderUserProfile(b)}})};renderUserProfile=function(b){if(b.error==undefined){$(".userName").html(b.userDisplayName);var a="";if(b.knownlanguages!=null){a=b.knownlanguages.split(",")}console.log(a);UpdateLanguagesUI(a);buildUsersAudioList(b.audioList)}};buildUsersAudioList=function(a){console.log(a);$.each(a,function(c,b){var e=document.createElement("div");var f=document.createElement("div");var g=document.createElement("a");var h="";var d="";if(b.videolink.indexOf("youtube")>=0){ytID=b.videolink.split("/embed/")[1];d=ytID;h="http://img.youtube.com/vi/"+ytID+"/mqdefault.jpg"}else{if(b.videolink.indexOf("gfycat")>=0){h="http://thumbs."+b.videolink+"-thumb100.jpg";d=b.videolink}}$(f).addClass("audioDetails").append("<span class='audioName'>"+b.audname+"</span> in <span class='audioLang'> "+b.language+" </span>");$(g).attr("href","/studio?li="+d+"&abk="+b.audkey).append(f);$(e).addClass("userAudioWrapper").append(g);$(".audioListContainer").append(e)})};getLanguages=function(){$.ajax({type:"GET",url:baseurl+"/static/jsons/lang.json",dataType:"json",success:function(b){var a=b.sort(insensitive);$.each(a,function(d,c){$("#languageList").append('<option value="'+c+'">'+c+"</option>")})}})};selectLanguage=function(a){if(languagesKnown.indexOf(a)<0){languagesKnown.push(a);addLangugeToTheBucket(a)}};addLangugeToTheBucket=function(d){console.log(languagesKnown);var b=document.createElement("div");var c=document.createElement("span");var a=document.createElement("span");$(a).addClass("removeLang").attr("aria-hidden","true").html("&times;");$(c).html(d);$(b).addClass("langTag").append(c).append(a);$(".selectedLanguages").append(b);$(a).click(function(f){f.stopPropagation();removeLangFromList(d);$(this).parent().remove()})};removeLangFromList=function(a){languagesKnown.pop(a)};updateLanguages=function(){var a={handle:userDisplayName,langs:languagesKnown};$.ajax({type:"GET",url:baseurl+"/user/updateuserlangauges?handle="+userDisplayName+"&langs="+languagesKnown,dataType:"json",success:function(b){if(b.result=="success"){console.log(b.langList);UpdateLanguagesUI(b.langList.split(","));$(".chooseLanguages").hide()}else{}setTimeout(function(){$(".msg").remove()},5000)}})};UpdateLanguagesUI=function(a){console.log(a.length);if(a.length!=0){var b="";$.each(a,function(d,c){b=b+c+", "});console.log(b);b=b.substring(0,b.length-2);$(".languagesKnown").html(b)}else{$(".languagesKnown").html("Set your languages")}};