(function(d,e,j,h,f,c,b){d.GoogleAnalyticsObject=f;d[f]=d[f]||function(){(d[f].q=d[f].q||[]).push(arguments)},d[f].l=1*new Date();c=e.createElement(j),b=e.getElementsByTagName(j)[0];c.async=1;c.src=h;b.parentNode.insertBefore(c,b)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");var recordplayer;var videoID="";var yturl="//www.youtube.com/embed/";var videottype="";var gifurl="";var videourl="";var timer="";var count=3;var previewstarttime=0;var wantsToRecord=false;var resumedRecording=false;var viewingPreview=false;var pausedRecording=false;var resumedRecording=false;var videoHeight=350;var recordRTC="";var VideoName="";var bloburl="";var sortOption="dubscount";var recordingSession=false;function onYouTubeIframeAPIReady(){recordplayer=new YT.Player("videoplayer",{height:videoHeight,width:"100%",videoId:videoID,events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange},playerVars:{fs:1}})}function onPlayerReady(a){}function onPlayerStateChange(a){if(a.data==YT.PlayerState.PLAYING){if(recordingSession==true){if(wantsToRecord==true&&resumedRecording==false){wantsToRecord=false;ga("dubroo.send","event","Audio","Recording",VideoName);$(".recordbtn").html("Record");recordingSesseionOn();$(".recordingStatus").html("Recording ...");recordplayer.pauseVideo();recordBegin()}else{if(resumedRecording==true){$(".resumebtn").hide();$(".pausebtn").show();recordRTC.resumeRecording();$(".recordingStatus").html("Recording Resumed ...")}}}else{if(viewingPreview==true){if(videoCategory=="karaoke"){recordplayer.unMute()}else{recordplayer.mute()}$("#audio")[0].play()}}}else{if(a.data==YT.PlayerState.ENDED){if(recordingSession==true){$(".stopbtn").trigger("click")}}}}$(document).ready(function(){page="studio";ga("create","UA-58598109-1","auto",{name:"dubroo"});ga("send","pageview");$("#audio").bind("ended",function(){recordplayer.stopVideo()});if(videottype=="gif"){$(".videostarttime").hide();$(".pauseResumeStopDiv").hide();$(".starttime").hide();$(".gifstop").show()}else{$(".gifstop").hide()}$("#audio").unbind().bind("loadeddata",function(){var a=0;if(recordplayer==undefined){onYouTubeIframeAPIReady();setTimeout(function(){recordplayer.loadVideoById({videoId:videoID,startSeconds:parseInt(a)});if(videoCategory=="karaoke"){recordplayer.unMute()}else{recordplayer.mute()}recordplayer.playVideo()},1000)}else{var c=$(".previewstarttime input").val();previewstarttime=parseFloat(c);if(c==""){c=0;previewstarttime=0}viewingPreview=true;$(".previewaudioplayer").css("display","inline-block");if(previewstarttime<0){var b=-(previewstarttime);var d=document.getElementById("audio");d.currentTime=b}recordplayer.loadVideoById({videoId:videoID,startSeconds:parseInt(previewstarttime)});if(videoCategory=="karaoke"){recordplayer.unMute()}else{recordplayer.mute()}recordplayer.playVideo()}});$("#audio").bind("ended",function(){audioisplaying=false;$(this).attr("src","");recordplayer.stopVideo();previewSessionOn()});$("#audio").bind("pause",function(){recordplayer.pauseVideo();recordplayer.unMute()});$("#audio").bind("seeked",function(){var a=parseFloat($(this)[0].currentTime)+previewstarttime;recordplayer.seekTo(a)});$("#audio").bind("waiting",function(){audiobuffering=true;audioispaused=false;audioisplaying=false;recordplayer.pauseVideo();recordplayer.unMute()});$("#audio").bind("playing",function(){audiobuffering=false;recordplayer.mute();if(videoCategory=="karaoke"){recordplayer.unMute()}recordplayer.playVideo()});$(".recordbtn").click(function(a){if(recordRTC!=""){if(wantsToRecord==false){count=3;$(".counter").empty().show();blob="";$(".audiometadata").hide();recordplayer.stopVideo();$("#audio").attr("src","");$(this).html("wait");wantsToRecord=true;timer=setInterval(function(){handleTimer(count)},1000)}}else{$(".enableMicrophone").show();$(".bgcover,.messageboard").slideDown(200);$(".messageboard p").html("Enable microphone to Record your Voice");$(".closebtn,.okbtn,.bgcover").unbind().bind("click",function(){$(".bgcover,.messageboard").slideUp(200);$(".messageboard p").empty()});enableMicrophone()}});$(".enableMicrophone").click(function(a){a.stopPropagation();if(recordRTC==""){enableMicrophone()}else{$(this).hide()}});$(".pausebtn").click(function(){pausedRecording=true;resumedRecording=false;recordplayer.pauseVideo();videoStoppedTime=Math.floor(recordplayer.getCurrentTime());$(this).hide();$(".resumebtn").show();recordRTC.pauseRecording();$(".recordingStatus").html("Recording Paused")});$(".resumebtn").click(function(){resumedRecording=true;pausedRecording=false;recordplayer.loadVideoById({videoId:videoID,startSeconds:parseInt($.trim(videoStoppedTime))});if(videoCategory=="karaoke"){recordplayer.unMute()}else{recordplayer.mute()}recordplayer.playVideo()});$(".stopbtn").click(function(){previewSessionOn();recordingSession=false;if(videottype!="gif"){recordplayer.stopVideo()}$(".resumebtn").hide();$(".recordingStatus").html("Preview recording");resumedRecording=false;pausedRecording=false;wantsToRecord=false;$(".pageloader").show();recordRTC.resumeRecording();recordRTC.stopRecording(function(a){audiou=a;blob=recordRTC.getBlob();recordplayer.stopVideo();$(".pageloader").hide()})});$(".cancelbtn").click(function(){$(".audioname input").val("");$(".starttime input").val("");resetRecordingPage();$("#audio").attr("src","");$(".recordingStatus").html("");blob=""});$(".gifstop").click(function(){$(".gfyVid")[0].pause();$("#audio").attr("src","")});$(".previewbtn").click(function(){if(videottype=="gif"){$(".gfyVid")[0].load();previewstarttime=parseFloat($(".previewstarttime input").val());$("#audio").attr("src",audiou).attr("loop","loop");if(previewstarttime<0){var b=-(previewstarttime);var c=document.getElementById("audio");c.currentTime=b}ga("dubroo.send","event","Audio_preview","vid_"+VideoName,"by_"+username);if($(".audiometadata").is(":hidden")){var a=$(".previewstarttime input").val();if(a==""){a=0;previewstarttime=0}$(".audiometadata").show()}}else{$("#audio").attr("src",URL.createObjectURL(blob));$("#audio").load();previewingSession()}});$(".stopPreview").click(function(a){a.stopPropagation();$("#audio").attr("src","");previewSessionOn()});$(".audioname input").change(function(){getBurl()});$(".uploadaudio").click(function(){var a=$(".audioname input").val().toLowerCase();if($.trim(a)!=""){if(userLoginStatus==true){UploadAudio()}else{readyToUpload=true;$("#loginModal").modal("show")}}else{$(".bgcover,.messageboard").show();$(".messageboard p").html("Audio should have a name!!!");$(".closebtn,.okbtn,.bgcover").unbind().bind("click",function(){$(".bgcover,.messageboard").hide();$(".messageboard p").empty()})}})});function getVideoDetails(){$.ajax({type:"GET",url:baseurl+"/getVideoDetails?videoUrl="+videourl,dataType:"json",success:function(a){if(videottype=="gif"){$(".videoplayer").hide();$(".gifholder").append("<img class='gfyitem' data-id='"+videoID+"' />")}$(".videoname").html(a.videoname);VideoName=a.videoname;videoCategory=a.videocat;getVideoLinksForNonGallery();$(".catTabs ."+videoCategory+"-li").addClass("active");$("title").html(VideoName+" - Dubroo");ga("dubroo.send","event","Page visit","studio",VideoName);setTimeout(function(){$(".gifholder .gfyVid").attr("width",600).attr("height",450);$(".gifholder .gfyitem > div").css("width","600px").css("height",450);$(".gifholder .gfyPreLoadCanvas").attr("width",600).attr("height",450)},3000)}})}function getBurl(){$.ajax({type:"GET",url:baseurl+"/getburl",dataType:"text",success:function(a){bloburl=a}})}function getLanguages(){$.ajax({type:"GET",url:baseurl+"/static/jsons/lang.json",dataType:"json",success:function(b){$(".languageFilterSelect").append('<option value="all">Select a language</option>');var a=b.sort(insensitive);$.each(a,function(d,c){$(".langselector").append('<option value="'+c+'">'+c+"</option>")})}})}function storeAudio(a,b,e,d,f){var c=new FormData();c.append("blob",blob);c.append("composer",b);c.append("composeremail",e);c.append("videolink",videourl);c.append("audioname",a);c.append("starttime",d);c.append("language",f);$.ajax({type:"POST",url:bloburl,data:c,dataType:"json",processData:false,contentType:false,success:function(h){var g=new Date();g=g.getDate();ga("dubroo.send","event","Audio","Uploaded",a);ga("dubroo.send","event","Audio","Uploaded_for",VideoName);ga("dubroo.send","event","Audio","Uploaded_on",g);if(videottype=="gif"){window.location=baseurl+"/studio?li="+videourl+"&abk="+h.result}else{window.location=baseurl+"/studio?li="+videoID+"&abk="+h.result}}})}startRecording=function(){$(".counter").hide();if(videottype=="gif"){var b=$(".gfyVid")[0].duration;b=parseFloat(b)*1000;recordRTC.startRecording();$(".gfyVid")[0].load();$(".recordbtndiv").hide();$(".pauseResumeStopDiv").show();$(".recordingStatus").html("Recording ...");setTimeout(function(){$(".stopbtn").trigger("click")},b)}else{var a=$(".videostarttime input").val();if(a==""){a=0}recordplayer.loadVideoById({videoId:videoID,startSeconds:parseInt($.trim(a))});wantsToRecord=true;recordingSession=true;if(videoCategory=="karaoke"){recordplayer.unMute()}else{recordplayer.mute()}recordplayer.playVideo()}};enableMicrophone=function(){navigator.getUserMedia({audio:true},function(a){recordRTC=RecordRTC(a,{type:"audio",recorderType:StereoAudioRecorder,numberOfAudioChannels:1});$(".bgcover,.messageboard").slideUp(200);$(".messageboard p").empty();$(".enableMicrophone").hide()},function(){recordRTC=""})};function endCountdown(){startRecording()}function handleTimer(){if(count===0){clearInterval(timer);endCountdown()}else{$(".recordingStatus").html("Recording starts in - ");$(".counter").html(count);count--}}UploadAudio=function(){var a=$(".audioname input").val().toLowerCase();var b=userDisplayName;var d=uniqueID;var c=previewstarttime;var e=$(".langselector").val();if($.trim(a)!=""){$(".pageloader").show();$(".audiometadata").hide();storeAudio(a,b,d,c,e)}else{$(".bgcover,.messageboard").show();$(".messageboard p").html("Audio should have a name!!!");$(".closebtn,.okbtn,.bgcover").unbind().bind("click",function(){$(".bgcover,.messageboard").hide();$(".messageboard p").empty()})}};examineRecordingPageUrl=function(a){videoID=a.split("?li=")[1];yturl="//www.youtube.com/embed/"+videoID;videottype="";gifurl=videoID;videourl=yturl;if(videoID.indexOf("gfycat")!=-1){videoID=videoID.split("/")[1];videourl=gifurl;videottype="gif"}else{setTimeout(function(){if(recordplayer==undefined){onYouTubeIframeAPIReady()}},100)}$(".gotoStudio").attr("href","/studio?li="+videoID);getVideoDetails();if(chromebrowser==true){$(".recordstudio > div").hide();$(".recordstudio > p").show()}else{$(".recordstudio > div").show();$(".recordstudio > p").hide()}getLanguages()};recordingSesseionOn=function(){$(".UploadFunctions,.audiometadata,.previewFunctionBtns,.recordbtndiv,.previewaudioplayer").hide();$(".pauseResumeStopDiv").show()};previewSessionOn=function(){$(".pauseResumeStopDiv,.previewaudioplayer").hide();$(".UploadFunctions,.audiometadata,.previewFunctionBtns,.previewFunctions").show();$(".previewstarttime input").attr("disabled",false);$(".previewstarttime input").val($(".videostarttime input").val())};previewingSession=function(){$(".UploadFunctions,.audiometadata ,.recordbtndiv,.previewFunctions,.previewFunctionBtns").hide();$(".previewaudioplayer").show()};resetRecordingPage=function(){$(".pauseResumeStopDiv,.audiometadata,.previewaudioplayer,.previewFunctions,.UploadFunctions,.previewFunctionBtns").hide();$(".recordbtndiv").show()};recordBegin=function(){recordRTC.startRecording();recordplayer.playVideo()};